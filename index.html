<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Обновленный CSP с явным разрешением ваших доменов -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https://arterrii.ru https://arterrii.vercel.app https://cdn.jsdelivr.net https://fonts.googleapis.com;
        script-src 'self' https://arterrii.ru https://arterrii.vercel.app https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval';
        style-src 'self' https://arterrii.ru https://arterrii.vercel.app https://fonts.googleapis.com 'unsafe-inline';
        img-src 'self' https://arterrii.ru https://arterrii.vercel.app data:;
        connect-src 'self' https://arterrii.ru https://arterrii.vercel.app;
        font-src 'self' https://arterrii.ru https://arterrii.vercel.app https://fonts.gstatic.com;
        frame-src 'self' https://arterrii.ru https://arterrii.vercel.app;
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="allow-from https://arterrii.ru https://arterrii.vercel.app">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>AT-Infinity | Circular Glowing Logo</title>
    <style>
        /* Ваши стили остаются без изменений */
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code&display=swap');
        
        body { 
            margin: 0; 
            overflow: hidden; 
            background: transparent; 
            cursor: none;
            touch-action: manipulation;
        }
        #logo-container {
            position: fixed;
            top: 0px;
            left: 0px;
            width: 120px;
            height: 120px;
            z-index: 1000;
            background: transparent;
        }
        #cursor-container {
            position: fixed;
            width: 70px;
            height: 70px;
            pointer-events: none;
            z-index: 1001;
            transform: translate(-50%, -50%);
            display: none;
            background: transparent;
        }
        /* Остальные стили... */
    </style>
</head>
<body>
    <!-- Ваша HTML-разметка остается без изменений -->
    <div id="white-overlay"></div>
    <div id="logo-container">
        <canvas id="logo-canvas"></canvas>
    </div>
    <div id="cursor-container">
        <canvas id="cursor-canvas"></canvas>
    </div>

    <div id="arterii-license">
        <div>© 2025 ARTERRII. Все права защищены</div>
        <div>Это цифровой арт-музей. Только для просмотра</div>
        <div>Копирование и использование запрещено</div>
    </div>

    <span class="telegram-btn" id="telegram-link" title="Telegram"></span>
    <span class="fullscreen-btn" id="fullscreen-toggle">↘</span>

    <!-- Подключаем Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/FontLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/geometries/TextGeometry.js"></script>

    <script>
        // 1. Сначала проверяем, что все необходимые элементы DOM загружены
        document.addEventListener('DOMContentLoaded', function() {
            // 2. Проверяем, что canvas элементы существуют
            const logoCanvas = document.getElementById('logo-canvas');
            const cursorCanvas = document.getElementById('cursor-canvas');
            
            if (!logoCanvas || !cursorCanvas) {
                console.error('Canvas elements not found!');
                return;
            }

            // 3. Инициализируем Three.js сцену
            try {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    canvas: logoCanvas,
                    alpha: true
                });
                renderer.setSize(210, 210);
                renderer.setPixelRatio(window.devicePixelRatio);
                camera.position.z = 8;

                // Ваш код создания логотипа и анимации...
                const colors = [
                    '#7F00FF', '#0000FF', '#00BFFF', 
                    '#00FF80', '#FFFF00', '#FF6000', '#FF0000'
                ];

                let centerBall;
                let logoGroup;
                let smallBalls = [];
                let textMaterial;
                let isCursorActive = false;

                const fontLoader = new THREE.FontLoader();
                fontLoader.load('https://cdn.jsdelivr.net/npm/three@0.132.2/examples/fonts/helvetiker_regular.typeface.json', function(font) {
                    // Код создания логотипа...
                    const textHeight = 0.5;
                    const textSize = 0.2;
                    const textParams = {
                        font: font,
                        size: textSize,
                        height: textHeight,
                        curveSegments: 12,
                        bevelEnabled: false
                    };

                    textMaterial = new THREE.MeshPhongMaterial({
                        color: 0xffffff,
                        emissive: 0xffffff,
                        emissiveIntensity: 1,
                        shininess: 100,
                        transparent: true,
                        opacity: 0.9
                    });

                    function create3DText(char, isUpsideDown = false) {
                        const textGeo = new THREE.TextGeometry(char, textParams);
                        textGeo.computeBoundingBox();
                        const textMesh = new THREE.Mesh(textGeo, textMaterial);
                        
                        if (isUpsideDown) {
                            textMesh.rotation.z = Math.PI;
                        }
                        
                        return textMesh;
                    }

                    const radius = 2;
                    logoGroup = new THREE.Group();

                    const letters = [
                        { char: 'A', angle: 0 },
                        { char: 'T', angle: Math.PI / 2 },
                        { char: 'A', angle: Math.PI, isUpsideDown: true },
                        { char: 'T', angle: Math.PI * 1.5, isUpsideDown: true }
                    ];

                    letters.forEach((letter) => {
                        const text = create3DText(letter.char, letter.isUpsideDown);
                        text.position.set(
                            Math.cos(letter.angle) * radius,
                            Math.sin(letter.angle) * radius,
                            0
                        );
                        text.rotation.z = letter.angle + Math.PI / 2;
                        logoGroup.add(text);
                    });

                    scene.add(logoGroup);

                    // Центральный шар
                    const centerBallGeometry = new THREE.SphereGeometry(0.7, 32, 32);
                    const centerBallMaterial = new THREE.MeshPhongMaterial({
                        color: 0xffffff,
                        emissive: 0xffffff,
                        emissiveIntensity: 2,
                        shininess: 100,
                        transparent: true,
                        opacity: 0.95
                    });
                    centerBall = new THREE.Mesh(centerBallGeometry, centerBallMaterial);
                    scene.add(centerBall);

                    // Маленькие шарики
                    const ballGeometry = new THREE.SphereGeometry(0.15, 16, 16);
                    
                    colors.forEach((color, i) => {
                        const ballMaterial = new THREE.MeshPhongMaterial({
                            color: new THREE.Color(color),
                            emissive: new THREE.Color(color),
                            emissiveIntensity: 1.5,
                            shininess: 50,
                            transparent: true,
                            opacity: 0.9
                        });
                        const ball = new THREE.Mesh(ballGeometry, ballMaterial);
                        
                        const angle = (i / colors.length) * Math.PI * 2;
                        const distance = 4.5;
                        ball.position.set(
                            Math.cos(angle) * distance,
                            Math.sin(angle) * distance,
                            0
                        );
                        
                        smallBalls.push(ball);
                        scene.add(ball);
                    });

                    // Освещение
                    const ambientLight = new THREE.AmbientLight(0x404040);
                    scene.add(ambientLight);

                    const pointLight = new THREE.PointLight(0xffffff, 2, 10);
                    pointLight.position.set(0, 0, 2);
                    scene.add(pointLight);

                    // Курсор
                    const cursorRenderer = new THREE.WebGLRenderer({ 
                        antialias: true,
                        canvas: cursorCanvas,
                        alpha: true
                    });
                    cursorRenderer.setSize(40, 40);
                    cursorRenderer.setPixelRatio(window.devicePixelRatio);

                    const cursorScene = new THREE.Scene();
                    const cursorCamera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                    cursorCamera.position.z = 8;

                    // Обработчики событий и анимация...
                    document.addEventListener('mousemove', (e) => {
                        if (!isCursorActive) {
                            scene.remove(centerBall);
                            isCursorActive = true;
                            document.getElementById('cursor-container').style.display = 'block';
                        }
                        
                        document.getElementById('cursor-container').style.left = e.clientX + 'px';
                        document.getElementById('cursor-container').style.top = e.clientY + 'px';
                        
                        cursorScene.children = [];
                        cursorScene.add(centerBall);
                        cursorRenderer.render(cursorScene, cursorCamera);
                    });

                    function animate() {
                        requestAnimationFrame(animate);
                        
                        logoGroup.rotation.z += 0.005;
                        
                        if (!isCursorActive) {
                            const pulse = 1 + Math.sin(Date.now() * 0.001) * 0.15;
                            centerBall.scale.setScalar(pulse);
                            centerBall.material.emissiveIntensity = 1 + Math.sin(Date.now() * 0.001) * 1;
                        }
                        
                        textMaterial.emissiveIntensity = 0.8 + Math.sin(Date.now() * 0.0015) * 0.5;
                        
                        smallBalls.forEach((ball, i) => {
                            const ballPulse = 0.8 + Math.sin(Date.now() * 0.001 + i) * 0.3;
                            ball.scale.setScalar(ballPulse);
                            ball.material.emissiveIntensity = 1 + Math.sin(Date.now() * 0.001 + i * 2) * 0.8;
                            
                            const angle = (i / colors.length) * Math.PI * 2 + Date.now() * 0.0007;
                            const distance = 4.5 + Math.sin(Date.now() * 0.001 + i) * 0.4;
                            ball.position.set(
                                Math.cos(angle) * distance,
                                Math.sin(angle) * distance,
                                0
                            );
                        });
                        
                        renderer.render(scene, camera);
                        
                        if (isCursorActive) {
                            const pulse = 1 + Math.sin(Date.now() * 0.001) * 0.15;
                            centerBall.scale.setScalar(pulse);
                            centerBall.material.emissiveIntensity = 1 + Math.sin(Date.now() * 0.001) * 1;
                            cursorRenderer.render(cursorScene, cursorCamera);
                        }
                    }
                    
                    animate();
                });
            } catch (e) {
                console.error('Three.js initialization error:', e);
            }
        });

        // Ваш остальной код (полноэкранный режим и кнопки)...
    </script>
</body>
</html>
