name: Obfuscate and Deploy to Vercel

on:
  push:
    branches:
      - main  # или другая твоя ветка, если используешь dev/master

jobs:
  obfuscate-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: Install Obfuscator
        run: npm install -g javascript-obfuscator

      - name: Obfuscate JS Code
        run: |
          find . -name "*.js" -not -path "./node_modules/*" -exec javascript-obfuscator {} --output {} --compact true --self-defending true --control-flow-flattening true --control-flow-flattening-threshold 0.75 --dead-code-injection true --dead-code-injection-threshold 0.4 --string-array true --string-array-encoding rc4 --string-array-index-shift true --string-array-shuffle true --string-array-wrappers-chained-calls true --string-array-wrappers-type variable --split-strings true --split-strings-chunk-length 10 --unicode-escape-sequence true --transform-object-keys true --numbers-to-expressions true --identifier-names-generator hexadecimal --string-array-threshold 0.75 \;

      - name: Deploy to Vercel
        run: npx vercel --prod --token=$VERCEL_TOKEN --confirm --scope=$VERCEL_ORG_ID --project=$VERCEL_PROJECT_ID
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
          VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
          VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}
